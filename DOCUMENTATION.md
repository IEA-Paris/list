# List Project Documentation

The List project (@paris-ias/list) is a Nuxt 3 module for displaying data in various list formats with advanced filtering, sorting, and pagination capabilities.

## Overview

This project provides a comprehensive solution for rendering data lists with multiple view options, dynamic filtering, and seamless integration with the Paris IAS type system. It's designed as a reusable Nuxt module that can be integrated into any Nuxt 3 application.

## Key Features

- **Nuxt 3 Module**: Full integration with Nuxt ecosystem and auto-imports
- **Multiple View Types**: Grid, dense, and expandable list views
- **Advanced Filtering**: Type-safe filters with conditional visibility
- **Flexible Sorting**: Multiple sort criteria with intuitive icons
- **Smart Pagination**: Configurable items per page with user preferences
- **GraphQL Integration**: Apollo client support for data fetching
- **Vuetify Components**: Material Design UI components
- **Internationalization**: Multi-language interface support
- **TypeScript**: Full type safety throughout
- **Dynamic State**: Automatic store generation per data type

## Architecture

### Module Structure

```
list/
├── src/
│   ├── module.ts                    # Nuxt module definition
│   └── runtime/
│       ├── components/              # Vue components (atomic design)
│       │   ├── atoms/              # Basic UI elements
│       │   ├── molecules/          # Composite components
│       │   └── organisms/          # Complex list interfaces
│       ├── composables/            # Vue composables and utilities
│       │   ├── useUtils.ts        # General utilities
│       │   ├── useIcons.ts        # Icon management
│       │   └── useFetchItem.ts    # Data fetching logic
│       ├── stores/                 # Pinia state management
│       │   ├── factory.ts         # Dynamic store factory
│       │   └── root.ts            # Global state management
│       ├── plugins/               # Nuxt plugins
│       │   ├── pinia.ts          # Pinia configuration
│       │   └── vuetify.ts        # Vuetify setup
│       ├── graphql/               # GraphQL queries and mutations
│       │   ├── queries/          # Data fetching queries
│       │   └── mutations/        # Data modification mutations
│       ├── translations/          # i18n language files
│       │   ├── en.json           # English translations
│       │   └── fr.json           # French translations
│       └── public/               # Static assets
├── playground/                    # Development and testing environment
│   ├── nuxt.config.ts           # Playground configuration
│   ├── app.vue                  # Test application
│   └── pages/                   # Test pages
└── package.json
```

## Core Components

### Dynamic Store System

The list module uses a dynamic store factory that creates type-specific stores based on generated configurations:

```typescript
// stores/factory.ts
export const createDynamicStore = (storeName: string, moduleState: object) => {
  return defineStore(storeName, () => {
    const state = reactive({
      // Common list state
      loading: false,
      total: 0,
      skip: 0,
      page: 1,
      numberOfPages: 0,
      search: "",
      error: null,

      // Type-specific state from generated config
      ...moduleState,
    })

    return {
      ...toRefs(state),
      // Additional computed properties and methods
    }
  })
}
```

### Component Hierarchy (Atomic Design)

The components follow atomic design principles:

#### Atoms (Basic Elements)

- **Buttons**: Action buttons, filter toggles
- **Icons**: Consistent iconography system
- **Inputs**: Search fields, filter inputs
- **Labels**: Text labels and badges

#### Molecules (Composite Components)

- **ListItem**: Individual list item display
- **FilterControl**: Single filter interface
- **PaginationControl**: Page navigation
- **SortSelector**: Sorting option selector
- **ViewToggle**: View type switcher

#### Organisms (Complex Interfaces)

- **ListContainer**: Complete list with all features
- **FilterPanel**: Advanced filtering interface
- **ListHeader**: Title, controls, and metadata
- **ListFooter**: Pagination and summary

## Configuration System

The list module consumes configurations generated by the types project:

### Generated List Configuration Example

```javascript
// From types/dist/list/people.js
export default {
  items: [], // Data items (populated at runtime)
  itemsPerPage: 20, // Default items per page
  itemsPerPageArray: [20, 40, 60, 80, 100], // Available options
  filtersCount: 0, // Active filter count
  views: {
    dense: {
      default: true,
      name: "dense",
      icon: "land-rows-horizontal",
      perPage: {
        options: [20, 40, 60, 80, 100],
        default: 20,
      },
    },
    rows: {
      name: "rows",
      icon: "view-list",
      perPage: {
        options: [9, 12, 16],
        default: 9,
      },
    },
  },
  sort: {
    nameasc: {
      icon: "sort-alphabetical-ascending",
      text: "by-name-from-a-to-z",
      value: ["lastname", 1],
    },
    namedesc: {
      icon: "sort-alphabetical-descending",
      text: "by-name-from-z-to-a",
      value: ["lastname", -1],
    },
    vintageasc: {
      icon: "sort-calendar-descending",
      text: "by-vintage-from-recent-to-old",
      value: ["groups.vintage.year", -1],
      default: true,
    },
  },
  filters: {
    groups: {
      type: "Select",
    },
    vintage: {
      type: "Select",
      visibility: {
        default: false,
        switchIf: [{ groups: "fellows" }],
        disjonctive: false,
      },
      multiple: true,
    },
  },
}
```

## Usage

### Installation

```bash
# Install the module
npm install @paris-ias/list

# Install required dependencies
npm install @paris-ias/data
```

### Nuxt Configuration

```typescript
// nuxt.config.ts
export default defineNuxtConfig({
  modules: ["@paris-ias/list", "@nuxtjs/apollo", "@pinia/nuxt", "@nuxtjs/i18n"],

  // Module configuration
  list: {
    // Module options
  },

  // Apollo GraphQL configuration
  apollo: {
    clients: {
      default: {
        httpEndpoint: process.env.GRAPHQL_ENDPOINT,
        httpLinkOptions: {
          headers: {
            "x-api-key": process.env.GRAPHQL_API_KEY,
          },
        },
      },
    },
  },
})
```

### Basic Usage in Pages

```vue
<!-- pages/people.vue -->
<template>
  <div>
    <h1>People Directory</h1>
    <ListOrganismsList type="people" :config="peopleConfig" />
  </div>
</template>

<script setup>
import { listPeople } from "@paris-ias/data"

// Import generated configuration
const peopleConfig = listPeople

// Set page meta
definePageMeta({
  title: "People Directory",
  description: "Browse our community members",
})
</script>
```

### Advanced Usage with Custom Queries

```vue
<template>
  <ListOrganismsList
    type="people"
    :config="config"
    :custom-query="customQuery"
    @item-selected="handleSelection"
  />
</template>

<script setup>
import { gql } from "graphql-tag"

const config = {
  ...listPeople,
  // Override default configuration
  views: {
    cards: {
      icon: "view-grid",
      default: true,
    },
  },
}

const customQuery = gql`
  query GetPeople($filter: PeopleFilter, $sort: PeopleSort) {
    people(filter: $filter, sort: $sort) {
      id
      firstname
      lastname
      image
      affiliations {
        affiliation {
          name
        }
      }
    }
  }
`

const handleSelection = (person) => {
  navigateTo(`/people/${person.id}`)
}
</script>
```

## Features Deep Dive

### 1. Multiple View Types

The module supports different presentation modes:

- **Dense View**: Compact table-like layout for maximum information density
- **Rows View**: Card-based layout with medium information density
- **Grid View**: Visual grid layout for image-heavy content
- **Expanded View**: Detailed view with full information display

### 2. Advanced Filtering

Filters support complex conditions and relationships:

```typescript
// Conditional filter visibility
{
  type: "Select",
  visibility: {
    default: false,                    // Hidden by default
    switchIf: [{ groups: "fellows" }], // Show when user selects "fellows" group
    disjonctive: false                 // AND logic (all conditions must be true)
  },
  multiple: true                       // Allow multiple selections
}
```

### 3. Flexible Sorting

Multiple sort options with intuitive controls:

```typescript
{
  icon: "sort-alphabetical-ascending",    // Material Design icon
  text: "by-name-from-a-to-z",          // i18n key for display text
  value: ["lastname", 1],                // MongoDB-style sort specification
  default: true                          // Default sort option
}
```

### 4. Smart Pagination

Configurable pagination with user preferences:

```typescript
{
  perPage: {
    options: [20, 40, 60, 80, 100],     // Available page sizes
    default: 20                          // Default page size
  }
}
```

## Composables and Utilities

### useUtils

General utilities for list functionality:

```typescript
// runtime/composables/useUtils.ts
export const useUtils = () => {
  const formatDate = (date: string) => {
    // Date formatting logic
  }

  const truncateText = (text: string, length: number) => {
    // Text truncation logic
  }

  const buildFilterQuery = (filters: Record<string, any>) => {
    // GraphQL query building
  }

  return {
    formatDate,
    truncateText,
    buildFilterQuery,
  }
}
```

### useIcons

Icon management with fallbacks:

```typescript
// runtime/composables/useIcons.ts
export const useIcons = () => {
  const getIcon = (iconName: string) => {
    // Icon resolution logic with fallbacks
  }

  const getSortIcon = (sortConfig: Sort) => {
    // Sort-specific icon logic
  }

  return {
    getIcon,
    getSortIcon,
  }
}
```

### useFetchItem

Data fetching with caching:

```typescript
// runtime/composables/useFetchItem.ts
export const useFetchItem = () => {
  const fetchItems = async (type: string, options: FetchOptions) => {
    // GraphQL query execution
    // Caching and error handling
  }

  const fetchSingleItem = async (type: string, id: string) => {
    // Single item fetching
  }

  return {
    fetchItems,
    fetchSingleItem,
  }
}
```

## GraphQL Integration

### Query Structure

The module expects GraphQL endpoints to follow specific patterns:

```graphql
# Query for list data
query GetPeople(
  $filter: PeopleFilter
  $sort: PeopleSort
  $limit: Int
  $skip: Int
) {
  people(filter: $filter, sort: $sort, limit: $limit, skip: $skip) {
    total
    items {
      id
      firstname
      lastname
      # ... other fields
    }
  }
}

# Filter input types
input PeopleFilter {
  groups: [String]
  vintage: [String]
  search: String
}

# Sort input types
input PeopleSort {
  field: String
  direction: Int # 1 for ascending, -1 for descending
}
```

## Internationalization

The module provides multi-language support:

### Translation Files

```json
// translations/en.json
{
  "list": {
    "loading": "Loading...",
    "no-results": "No results found",
    "items-per-page": "Items per page",
    "page": "Page",
    "of": "of",
    "filters": "Filters",
    "sort": "Sort by",
    "view": "View",
    "search": "Search"
  },
  "sort": {
    "by-name-from-a-to-z": "Name A-Z",
    "by-name-from-z-to-a": "Name Z-A"
  }
}
```

### Usage in Components

```vue
<template>
  <div>
    <h2>{{ $t("list.filters") }}</h2>
    <button>{{ $t("sort.by-name-from-a-to-z") }}</button>
  </div>
</template>
```

## Performance Considerations

### 1. Virtual Scrolling

For large datasets, consider implementing virtual scrolling:

```vue
<template>
  <VirtualList :items="items" :item-height="80" :visible-range="10">
    <template #item="{ item }">
      <ListItem :item="item" />
    </template>
  </VirtualList>
</template>
```

### 2. Lazy Loading

Images and non-critical content should be lazy-loaded:

```vue
<template>
  <img :src="item.image" loading="lazy" :alt="item.name" />
</template>
```

### 3. Caching Strategy

Implement intelligent caching for API responses:

```typescript
const { data, refresh } = await useLazyAsyncData(
  `people-${JSON.stringify(filters)}`,
  () => fetchPeople(filters),
  {
    server: false,
    default: () => ({ items: [], total: 0 }),
    transform: (data) => normalizeData(data),
  }
)
```

## Customization

### Theming with Vuetify

```scss
// Custom theme variables
$primary-color: #1976d2;
$secondary-color: #424242;
$accent-color: #82b1ff;

.list-container {
  --primary: #{$primary-color};
  --secondary: #{$secondary-color};
  --accent: #{$accent-color};
}
```

### Custom Components

Override default components by creating your own:

```vue
<!-- components/CustomListItem.vue -->
<template>
  <div class="custom-list-item">
    <!-- Custom item layout -->
  </div>
</template>
```

```typescript
// Register custom component
export default defineNuxtConfig({
  components: [
    {
      path: "~/components",
      pathPrefix: false,
    },
  ],
})
```

## Testing

### Component Tests

```typescript
// tests/components/ListItem.test.ts
import { mount } from "@vue/test-utils"
import { describe, it, expect } from "vitest"
import ListItem from "~/components/molecules/ListItem.vue"

describe("ListItem", () => {
  it("renders item data correctly", () => {
    const item = {
      id: "1",
      firstname: "John",
      lastname: "Doe",
    }

    const wrapper = mount(ListItem, {
      props: { item },
    })

    expect(wrapper.text()).toContain("John Doe")
  })
})
```

### E2E Tests

```typescript
// tests/e2e/list.spec.ts
import { test, expect } from "@playwright/test"

test("people list displays and filters work", async ({ page }) => {
  await page.goto("/people")

  // Wait for list to load
  await expect(page.locator('[data-testid="list-container"]')).toBeVisible()

  // Test filtering
  await page.click('[data-testid="filter-groups"]')
  await page.click('[data-testid="fellows-option"]')

  // Verify filtered results
  await expect(page.locator('[data-testid="list-item"]')).toHaveCount(5)
})
```

## Troubleshooting

### Common Issues

1. **Store not initialized**

   ```
   Error: Store 'people' is not initialized
   ```

   Solution: Ensure the list configuration is properly imported

2. **GraphQL errors**

   ```
   Error: Cannot query field "people" on type "Query"
   ```

   Solution: Verify GraphQL schema matches expected structure

3. **Translation missing**
   ```
   Warning: Translation key 'sort.custom-sort' not found
   ```
   Solution: Add missing keys to translation files

## Future Enhancements

1. **Virtual Scrolling**: For performance with large datasets
2. **Drag & Drop**: Reorderable lists and items
3. **Bulk Operations**: Select multiple items for batch actions
4. **Advanced Search**: Full-text search with highlighting
5. **Export Features**: CSV, PDF export capabilities
6. **Real-time Updates**: WebSocket support for live data
7. **Accessibility**: Enhanced ARIA support and keyboard navigation

## Contributing

When contributing to the list module:

1. Follow atomic design principles for components
2. Maintain TypeScript strict mode compliance
3. Add comprehensive tests for new features
4. Update documentation and examples
5. Consider performance implications
6. Test with different data types and configurations

The list module provides a powerful, flexible foundation for displaying any type of data with excellent user experience and developer ergonomics.
